# Spend Categorization Configuration
# Three modules: generate, categorize, app

# =============================================================================
# GENERATE - Data generation (0_generate.ipynb)
# Creates: invoices_raw -> invoices (with LLM descriptions)
# =============================================================================
generate:
  company:
    name: Borealis Wind Systems
    industry: Wind turbine manufacturing
    categories_file: categories.csv
    cost_centres:
      - CC-100-Production
      - CC-200-Maintenance
      - CC-300-Engineering
      - CC-400-IT
      - CC-500-Sales
      - CC-600-HR
      - CC-700-Logistics
      - CC-800-Admin
      - CC-900-Projects
    plants:
      - name: US-East Plant
        id: PLANT-US-E
        region: North America
        country: USA
      - name: US-West Plant
        id: PLANT-US-W
        region: North America
        country: USA
      - name: Germany-North
        id: PLANT-DE-N
        region: Europe
        country: Germany
      - name: Germany-South
        id: PLANT-DE-S
        region: Europe
        country: Germany
      - name: Vietnam Plant
        id: PLANT-VN
        region: Asia
        country: Vietnam
      - name: Brazil Plant
        id: PLANT-BR
        region: South America
        country: Brazil
    category_cost_centre_mapping:
      Raw Materials: CC-100-Production
      Components: CC-100-Production
      Sub-Assemblies: CC-100-Production
      Packaging Materials: CC-700-Logistics
      Blades & Hub Parts: CC-300-Engineering
      Electrical Assemblies: CC-100-Production
      Hydraulic Systems: CC-100-Production
      Bearings & Seals: CC-100-Production
      Fasteners: CC-100-Production
      Castings & Forgings: CC-100-Production
      MRO (Maintenance, Repair, Operations): CC-200-Maintenance
      IT & Software: CC-400-IT
      Facilities & Utilities: CC-200-Maintenance
      Logistics & Freight: CC-700-Logistics
      Professional Services: CC-900-Projects
      Office Supplies: CC-800-Admin
      Training & HR: CC-600-HR
      Travel & Entertainment: CC-800-Admin
      Temporary Labor / Contracting: CC-200-Maintenance
      Safety & PPE: CC-200-Maintenance
      Marketing & Advertising: CC-500-Sales
      Telecom & Connectivity: CC-400-IT
      Subscriptions & Data Services: CC-400-IT
      Cleaning & Janitorial: CC-800-Admin
      Security Services: CC-800-Admin
      Rent & Leases: CC-800-Admin
      Recruitment Services: CC-600-HR
      Events & Conferences: CC-500-Sales
      Payroll: CC-600-HR
      Government Services & Taxes: CC-800-Admin
      Finance Charges: CC-800-Admin
      Miscellaneous Expenses: CC-800-Admin

  # Delta tables created by 0_generate.ipynb
  tables:
    invoices_raw: invoices_raw # Python-generated base data
    invoices: invoices # LLM-enhanced with descriptions
    categories: categories # Category hierarchy from config

  data:
    catalog: shm
    schema: spend
    small_llm_endpoint: databricks-gpt-oss-20b
    large_llm_endpoint: databricks-claude-sonnet-4-5
    rows: 10000
    start: 2024-01-01
    end: 2025-12-31
    distribution:
      Direct: 0.6
      Indirect: 0.35
      Non-Procureable: 0.05
    python_columns:
      - date
      - order_id
      - category_level_1
      - category_level_2
      - category_level_3
      - cost_centre
      - plant
      - plant_id
      - region
      - amount
      - unit_price
      - total
    llm_columns:
      - supplier
      - supplier_country
      - description
    prompt: |
      Generate these fields based on the provided information:
      - description (max 15 words, realistic for category)
      - supplier (real company name, match category type and region)
      - supplier_country (ISO country code)

      Return a JSON object with supplier, supplier_country, and description.

      Invoice Information:

# =============================================================================
# CATEGORIZE - Classification models (2_bootstrap, 3_optimize, 4_catboost, 5_vectorsearch)
# Uses catalog/schema from generate section
# =============================================================================
categorize:
  # Delta tables for categorization
  tables:
    prompts: prompts # Prompt versions used for classification
    cat_bootstrap: cat_bootstrap # LLM bootstrap classifications
    cat_catboost: cat_catboost # CatBoost model predictions
    cat_vectorsearch: cat_vectorsearch # Vector search predictions

app:
  mode: test # test (mock data) or prod (Lakebase)
  page_size: 50
  default_user: user
  lakebase_instance: shm
  lakebase_dbname: databricks_postgres

  # Lakebase tables
  tables:
    invoices_sync: invoices_sync # synced from invoices
    categorization_sync: categorization_sync # synced from cat_bootstrap
    reviews: reviews # app writes, ingested to Delta

  ui:
    title: Spend Categorization
    icon: databricks

  search:
    default_fields:
      - invoice_number
      - vendor_name
      - description
    max_results: 500

  flagging:
    low_confidence_threshold: 0.7
    critical_confidence_threshold: 0.5
