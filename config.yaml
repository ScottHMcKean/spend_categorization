# Spend Categorization Configuration
# Three modules: generate, categorize, app

# =============================================================================
# GENERATE - Data generation (0_generate.ipynb)
# Creates: invoices_raw -> invoices (with LLM descriptions)
# =============================================================================
generate:
  company:
    name: Borealis Wind Systems
    industry: Wind turbine manufacturing
    categories_file: assets/categories.csv
    cost_centres:
      - CC-100-Production
      - CC-200-Maintenance
      - CC-300-Engineering
      - CC-400-IT
      - CC-500-Sales
      - CC-600-HR
      - CC-700-Logistics
      - CC-800-Admin
      - CC-900-Projects
    plants:
      - name: US-East Plant
        id: PLANT-US-E
        region: North America
        country: USA
      - name: US-West Plant
        id: PLANT-US-W
        region: North America
        country: USA
      - name: Germany-North
        id: PLANT-DE-N
        region: Europe
        country: Germany
      - name: Germany-South
        id: PLANT-DE-S
        region: Europe
        country: Germany
      - name: Vietnam Plant
        id: PLANT-VN
        region: Asia
        country: Vietnam
      - name: Brazil Plant
        id: PLANT-BR
        region: South America
        country: Brazil
  tables:
    invoices_raw: invoices_raw
    invoices: invoices
    categories: categories
    categories_str: categories_str
  data:
    catalog: shm
    schema: spend
    small_llm_endpoint: databricks-gpt-oss-20b
    large_llm_endpoint: databricks-claude-sonnet-4-5
    rows: 10000
    start: 2024-01-01
    end: 2025-12-31
    distribution:
      Direct: 0.6
      Indirect: 0.35
      Non-Procureable: 0.05
    python_columns:
      - date
      - order_id
      - category_level_1
      - category_level_2
      - category_level_3
      - cost_centre
      - plant
      - plant_id
      - region
      - amount
      - unit_price
      - total
    llm_columns:
      - supplier
      - supplier_country
      - description
    prompt: |
      Generate these fields based on the provided information:
      - description (max 15 words, realistic for category)
      - supplier (real company name, match category type and region)
      - supplier_country (ISO country code)

      Return a JSON object with supplier, supplier_country, and description.

      Invoice Information:

# =============================================================================
# CATEGORIZE - Categorization models (2_bootstrap, 3_optimize, 4_catboost, 5_vectorsearch)
# Uses catalog/schema from generate section
# Data flow: invoices -> cat_bootstrap (LLM) -> cat_reviews (human) -> cat_catboost/cat_vectorsearch (trained models) -> cat_reviews (feedback loop)
# =============================================================================
categorize:
  # Delta tables for categorization
  tables:
    prompts: prompts
    cat_bootstrap: cat_bootstrap
    cat_catboost: cat_catboost
    cat_vectorsearch: cat_vectorsearch 
    cat_reviews: cat_reviews

app:
  mode: test # test (mock data) or prod (Lakebase)
  page_size: 50
  default_user: user
  lakebase_instance: shm
  lakebase_dbname: databricks_postgres
  categorization_source: bootstrap # bootstrap | catboost | vectorsearch


  # App tables
  tables:
    reviews: reviews # Human review submissions

  ui:
    title: Spend Categorization
    icon: databricks

  search:
    default_fields:
      - invoice_number
      - vendor_name
      - description
    max_results: 500

  flagging:
    low_confidence_threshold: 0.7
    critical_confidence_threshold: 0.5
